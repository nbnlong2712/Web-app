# Story 1.11: Implement Admin Import Functionality

## Status
Draft

## Story
**As an** admin/editor,
**I want** to import tools via CSV form,
**so that** I can quickly seed the database with 100-200 tools.

## Acceptance Criteria
1. `/admin/import` page is created with CSV upload form
2. Form validates CSV structure and maps columns to schema
3. Import process shows created/updated counts and row-level error reporting
4. Admin protection is implemented via env access key
5. Slug generation and tag normalization work correctly
6. Import process performs within acceptable time limits

## Tasks / Subtasks
- [ ] Create admin import page
  - [ ] Create `app/admin/import/page.tsx` with form and upload functionality
  - [ ] Implement env access key protection
  - [ ] Design user-friendly import UI
- [ ] Implement CSV parsing and validation
  - [ ] Add file upload and parsing functionality
  - [ ] Validate CSV structure against expected schema
  - [ ] Implement column mapping interface
- [ ] Add preview functionality
  - [ ] Show preview of first 10 rows before import
  - [ ] Allow user to confirm or cancel import
- [ ] Implement import logic
  - [ ] Process CSV rows and upsert to `tools` table
  - [ ] Generate `slug` if missing
  - [ ] Normalize `tags` from `;` separated values
- [ ] Add error handling and reporting
  - [ ] Show created/updated counts
  - [ ] Report row-level errors with details
  - [ ] Handle database errors gracefully
- [ ] Test import functionality
  - [ ] Test with valid and invalid CSV files
  - [ ] Verify slug generation and tag normalization
  - [ ] Test performance with large datasets

## Dev Notes
### Import Requirements
- `/admin/import` (CSV form + server action)
- Show created/updated counts; row-level error reporting
- Generate `slug` if missing; normalize `tags` from `;`
- Protect via env access key or simple Basic Auth

[Source: docs/epic/epic-g-admin-import.md]

### Data Model
Tables:
- `tools`: Core catalog of AI tools and attributes

Schema (DDL):
```sql
create table if not exists tools (
  id uuid primary key default gen_random_uuid(),
  name text not null,
  slug text unique not null,
  description text,
  homepage_url text,
  affiliate_url text,
  primary_tag text,
  tags text[],
  pricing text check (pricing in ('free','freemium','paid')),
  platform text check (platform in ('web','api','desktop')),
  language text[],
  no_signup boolean default false,
  status text default 'live',
  last_updated date,
  created_at timestamp default now()
);
```

[Source: docs/architecture/3-data-model-supabase-postgres.md]

### Project Structure
```
ai-tools-library/
├─ app/
│  └─ admin/
│     └─ import/
│        └─ page.tsx                  # (opt) CSV import UI (env/role gated)
├─ scripts/
│  ├─ import-csv.ts                   # bulk import script
```

[Source: docs/architecture/source-tree.md]

### Security
- Protect via env access key or simple Basic Auth

[Source: docs/epic/epic-g-admin-import.md]

## Testing
### Test file location
- Tests should be placed in `tests/e2e/` directory for end-to-end testing
- Test file: `tests/e2e/admin-import.test.ts`

### Test standards
- Test CSV upload and parsing with various file formats
- Verify column mapping and preview functionality
- Test import process with valid and invalid data
- Verify slug generation and tag normalization
- Test error reporting for invalid rows

### Testing frameworks and patterns to use
- Use Playwright for end-to-end testing
- Test with various CSV formats and edge cases
- Mock Supabase client for testing database interactions
- Verify access key protection works correctly
- Test performance with large datasets

[Source: docs/architecture/coding_standards.md#8]

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
|      |         |             |        |

## Dev Agent Record
### Agent Model Used
TBD

### Debug Log References
TBD

### Completion Notes List
TBD

### File List
TBD

## QA Results
TBD