# Story 1.4: Implement Basic Chat-style Search Input

## Status
APPROVED

## Story
**As a** visitor,
**I want** a chat-style input on the home page to describe my need in natural language,
**so that** the system can quickly suggest suitable tools.

## Acceptance Criteria
1. Home page has a chat-style input component with glass styling
2. Input has proper placeholder text and focus behavior
3. Submit button and Enter key submission work correctly
4. Basic intent parsing function is implemented
5. Search results area is prepared for displaying tools
6. Loading states and empty states are implemented

## Tasks / Subtasks
- [x] Create chat input component
  - [x] Design chat input with glass styling matching Neo-Glassmorphism theme
  - [x] Implement placeholder and focus behavior
  - [x] Add Send button and Enter key submission
  - [x] Ensure proper accessibility attributes (labels, roles)
- [x] Implement intent parsing
  - [x] Create `lib/intent/parse.ts` with basic intent parsing function
  - [x] Implement parsing for basic filters (pricing, platform, language)
  - [x] Add synonym dictionary for tags in `lib/intent/synonyms.ts`
  - [x] Unit test the parser with sample inputs
- [x] Set up search results area
  - [x] Create SSR results region with `aria-live="polite"`
  - [x] Prepare structure for displaying tool cards
  - [x] Implement loading states with skeleton components
  - [x] Implement empty states with suggestions
- [x] Integrate search functionality
  - [x] Connect input to intent parser
  - [x] Prepare for database queries (will be implemented in next story)
  - [x] Test end-to-end flow with mock data
- [x] Verify accessibility
  - [x] Test keyboard navigation
  - [x] Verify screen reader announcements
  - [x] Check focus management

## Dev Notes
### Home Page Requirements
- `app/page.tsx` (Home): chat input, suggestion chips, SSR results region (aria-live="polite"), empty/loading states (skeleton shimmer >100ms)

[Source: docs/architecture/5-front-end-application-structure.md]

### Search & Intent Mapping
Non-LLM parser converts natural language to filters; SSR query combines filters + FTS/trigram similarity and returns ≤ 24 results sorted by specificity and similarity.

Parser (TypeScript, pseudocode):
```ts
export function parseIntent(input: string) {
  const text = normalize(input); // lowercase, strip punctuation, remove diacritics (VI)
  const out: any = { tags: [] };
  if (/(mien phi|free|0d|0đ)/.test(text)) out.pricing = 'free';
  else if (/freemium/.test(text)) out.pricing = 'freemium';
  else if (/(tra phi|paid|\$|usd|vnd|đ)/.test(text)) out.pricing = 'paid';
  if (/(khong can dang ky|no signup|khong can account)/.test(text)) out.no_signup = true;
  if (/\bapi\b/.test(text)) out.platform = 'api';
  if (/(web|trinh duyet)/.test(text)) out.platform = 'web';
  if (/(desktop|windows|macos|mac)/.test(text)) out.platform = 'desktop';
  if (/(tieng viet|vietnamese|\bvi\b)/.test(text)) out.language = ['vi'];
  if (/(english|\ben\b)/.test(text)) out.language = [...(out.language||[]), 'en'];
  // primary_tag & tag synonyms resolved from a static dictionary
  for (const [tag, syns] of Object.entries(SYN)) {
    if (syns.some(s => text.includes(s))) { out.primary_tag = tag; break; }
  }
  for (const [t, syns] of Object.entries(FLAT_TAGS)) {
    if (syns.some(s => text.includes(s))) out.tags.push(t);
  }
  return out;
}
```

[Source: docs/architecture/4-search-intent-mapping.md]

### Components
- `SearchBox`: Chat-style input with glass styling
- Need to create skeleton loading components

[Source: docs/architecture/5-front-end-application-structure.md#components]

### Styling and A11y
- **Glass UI**: Respect theme tokens (blur, borders, subtle shadows)
- **A11y**: Visible focus states, semantic HTML, proper ARIA; SSR results region uses `aria-live="polite"`

[Source: docs/architecture/coding_standards.md#7]

### Performance Budgets
- Home SSR TTFB ≤ 500ms (P50)
- Use skeleton loading for >100ms wait times

[Source: docs/architecture/coding_standards.md#9]

### Example Implementation
**`app/page.tsx`** (SSR search entry)
```tsx
import { parseIntent } from '@/lib/intent/parse'
export default async function Home({ searchParams }: { searchParams: { q?: string } }) {
  const q = (searchParams?.q ?? '').slice(0, 200)
  const intent = parseIntent(q)
  // TODO: call DB query once RPC is ready
  return (<main>/* input, results grid, a11y live region */</main>)
}
```

[Source: docs/architecture/source-tree.md#2]

## Testing
### Test file location
- Tests should be placed in `tests/unit/` directory
- Test file: `tests/unit/intent-parser.test.ts`

### Test standards
- Unit test the intent parser with various input scenarios
- Test both English and Vietnamese inputs
- Verify correct parsing of pricing, platform, and language filters

### Testing frameworks and patterns to use
- Vitest for unit testing
- Test the `parseIntent` function with 20 representative phrases (EN/VI) from the test cases
- Mock external dependencies
- Verify functionality with explicit assertions

[Source: docs/architecture/4-search-intent-mapping.md#test-cases]

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
|      |         |             |        |

## Dev Agent Record
### Agent Model Used
James (Full Stack Developer)

### Debug Log References
No debug logs required for this task.

### Completion Notes List
- Created chat input component with glass styling matching Neo-Glassmorphism theme
- Implemented intent parsing with basic filters (pricing, platform, language)
- Added synonym dictionary for tags to enhance search capabilities
- Set up search results area with SSR results region using aria-live="polite"
- Implemented loading states with skeleton components for better UX
- Integrated search functionality connecting input to intent parser
- Verified accessibility features including keyboard navigation and focus management
- All changes verified with typecheck, lint, and build commands

### File List
- src/components/SearchBox.tsx (created)
- src/lib/intent/parse.ts (updated)
- src/lib/intent/synonyms.ts (created)
- src/components/Skeletons.tsx (updated)
- src/app/page.tsx (updated)
- tests/unit/intent-parser.test.ts (created)
- vitest.config.ts (created)
- tests/setup.ts (created)

## QA Results
APPROVED - All issues addressed

### Summary
All issues identified in the previous QA review have been successfully addressed. The intent parser now correctly handles all test cases, and all unit tests are passing.

### Detailed Findings
1. **Intent Parser Issues - RESOLVED**:
   - Platform parsing now correctly identifies 'web tools' as platform: 'web'
   - Pricing patterns now correctly identify 'tools that cost money' as pricing: 'paid'
   - Tag synonym resolution is working correctly with the FLAT_SYNONYMS implementation

2. **Unit Test Failures - RESOLVED**:
   - All 6 tests are now passing
   - Parser correctly handles all expected cases
   - Edge cases are properly covered

3. **Accessibility - ENHANCED**:
   - Basic accessibility features were already well-implemented
   - The search results area correctly uses aria-live="polite"

4. **Component Implementation - VERIFIED**:
   - The SearchBox component maintains its well-designed glass styling
   - Keyboard navigation and focus management work correctly
   - Loading states with skeleton components are correctly implemented

### Risks
- All previously identified risks have been mitigated

### Recommendations
- None, all recommendations have been implemented

### Next Steps
- Ready for development of the next story